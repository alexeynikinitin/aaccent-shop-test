import{d as S,a as g,j as t,c as p,u as h,g as C,h as N,r as f,I as v,P as b}from"./index-e9eda421.js";import{B as A,a as E,s as x}from"./index-b72fe608.js";import{C as y}from"./index-286f18a9.js";import{s as R,D as T,A as $}from"./index-f634be44.js";const L=e=>e.catalog.items,k=e=>e.catalog.filterSettings,j=e=>{var r;return((r=e.catalog.filterSettings)==null?void 0:r.filteredProducts)??[]},D=e=>{var r;return(r=e.catalog.filterSettings)==null?void 0:r.priceRange},M=({count:e,id:r,regularPrice:c,title:a,basketButton:n})=>{const s=S();return g("div",{className:"productCard",onClick:()=>{s(`/product/${r}`)},children:[t("div",{className:"productCard__img",children:t("img",{src:`src/shared/assets/images/${r}.png`,alt:"img"})}),t("div",{className:"productCard__title",children:t("p",{children:a})}),t("div",{className:"productCard__counter",children:e&&t(A,{count:e,id:r,marginTop:"20px"})}),g("div",{className:"productCard__info",children:[t("span",{className:"productCard__info_price",children:`${c.value} ${c.currency}`}),n]})]})},w=()=>{var a;const e=p(k),{clearFilter:r}=h(C),{clearCheckedBrands:c}=h(N);return(a=e.checkedBrands)!=null&&a.length||e.priceRange?t("div",{className:"clearFilter",children:t(E,{title:"Сбросить фильтр",onClick:()=>{r(),c()},type:"outlined"})}):null},z=99999999,O=()=>{var n;const e=p(L),r=p(k),{setFilteredProducts:c}=h(C),a=()=>{const{checkedBrands:s,priceRange:i,filteredProducts:_}=r;let o=e;if(i&&(o=o.filter(u=>u.regular_price.value>=(i.from??0)).filter(u=>u.regular_price.value<=(i.to||z))),s&&s.length&&_){const u=[];s.forEach(d=>{const l=o.filter(m=>m.brand===d.id);u.push(...l)}),o=u}return o.length?o:e};return f.useEffect(()=>{if(e.length){const s=a();c({products:s})}},[r.priceRange,r.checkedBrands]),t("div",{className:"countFilteredProducts",children:t("span",{children:`найдено ${((n=r.filteredProducts)==null?void 0:n.length)??0} товаров`})})},V=({checked:e,id:r,title:c,onClickBrand:a})=>g("div",{className:"brandItem",onClick:()=>a(r),children:[t(y,{checked:e,readOnly:!0}),t("p",{className:"brandItem__title",children:c})]}),B=5,G=()=>{const[e,r]=f.useState(B),{items:c,count:a}=p(R),{checkBrand:n}=h(N),{setCheckedBrands:s}=h(C),i=()=>c.slice(0,e).map(({id:o,title:u,checked:d})=>t(V,{checked:d,id:o,title:u,onClickBrand:m=>{n({id:m})}},o)),_=()=>{r(e+B)};return f.useEffect(()=>{s({brands:c.filter(o=>o.checked)})},[c,s]),g("div",{className:"filterBrand",children:[t("h2",{className:"filterBrand__title",children:"Производитель"}),t("div",{className:"filterBrand__items",children:i()}),e<=a&&t("span",{className:"filterBrand__showMore",onClick:_,children:"Показать ещё"})]})},H=()=>{const{setFilterPriceRange:e}=h(C),r=p(D),c=s=>{e({from:Number(s),to:(r==null?void 0:r.to)??void 0})},a=s=>{e({from:(r==null?void 0:r.from)??void 0,to:Number(s)})},n=s=>{var i;return r?((i=r[s])==null?void 0:i.toString())??"":""};return g("div",{className:"filterPrice",children:[t("h2",{className:"filterPrice__title",children:"Цена"}),g("div",{className:"filterPrice__items",children:[t(v,{type:"number",className:"filterPrice__items_input",placeholder:"от",value:n("from"),onChangeInput:c}),t(v,{type:"number",className:"filterPrice__items_input",placeholder:"до",value:n("to"),onChangeInput:a})]})]})},U=()=>t("nav",{children:g("div",{className:"catalogFilter",children:[g("div",{className:"catalogFilter__block",children:[t(H,{}),t(G,{})]}),t(w,{}),t(O,{})]})}),W=6,X=()=>{const[e,r]=f.useState(1),[c,a]=f.useState(W),n=p(j),s=p(x),{getBrands:i}=h(N),_=(d,l)=>d?t(T,{id:d.id}):t($,{product:l}),o=d=>{const l=s.find(m=>m.id===d);return l==null?void 0:l.count},u=d=>{r(d)};return f.useEffect(()=>void i(),[i]),f.useEffect(()=>{r(1)},[n]),g("div",{className:"catalog",children:[t("div",{className:"catalog__list",children:n.slice((e-1)*c,c*e).map(d=>{const{id:l,title:m,regular_price:P}=d,F=s.find(I=>I.id===l);return t(M,{id:l,title:m,count:o(l),regularPrice:P,basketButton:_(F,{id:l,title:m,regular_price:P,count:1})},l)})}),t("div",{className:"catalog__paginator",children:n.length>c&&t(b,{pageSize:c,currentPage:e,setPageSize:a,totalCount:n.length,setCurrentPage:u})})]})};const Q=()=>{const{getCatalog:e}=h(C);return f.useEffect(()=>{e()},[e]),g("section",{className:"catalogPage",children:[t(U,{}),t(X,{})]})};export{Q as default};
